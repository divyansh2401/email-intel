
{% extends "base.html" %}
{% block body %}
  <div class="card">
    <h2>Emails</h2>
    <div class="row">
      <div>
        <input id="q" placeholder="search..."/>
      </div>
      <div>
        <input id="limit" value="50"/>
      </div>
      <div><button class="btn btn-green" onclick="load()">Search</button></div>
    </div>
    <div id="out" style="margin-top:12px;"></div>
  </div>
  <script>
    async function load(){
      const q = document.getElementById('q').value;
      const limit = document.getElementById('limit').value;
      const res = await fetch(`/api/emails?q=${encodeURIComponent(q)}&limit=${encodeURIComponent(limit)}`);
      const data = await res.json();
      const html = ['<table class="table"><thead><tr><th>Email</th><th>First Seen</th><th>Last Seen</th><th>Count</th></tr></thead><tbody>'].concat(
        data.map(r=>`<tr><td>${r.email}</td><td>${r.first_seen_ts}</td><td>${r.last_seen_ts}</td><td>${r.seen_count}</td></tr>`)
      ).concat('</tbody></table>').join('');
      document.getElementById('out').innerHTML = html;
    }
  </script>
{% endblock %}
